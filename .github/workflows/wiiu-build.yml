name: Build Wii U RPX

on:
  push:
    branches: [ "main", "master" ]
  pull_request:
    branches: [ "main", "master" ]

jobs:
  build-wiiu:
    runs-on: ubuntu-latest
    container: devkitpro/devkitppc:latest # Usa a imagem oficial do devkitPro

    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          submodules: recursive

      - name: Install Wii U dependencies
        run: |
          # Atualiza e instala bibliotecas espec√≠ficas do Wii U via pacman
          dkp-pacman -Syu --noconfirm
          dkp-pacman -S --noconfirm wiiu-dev wiiu-sdl2 wiiu-zlib wiiu-libpng wiiu-curl wut

      - name: Configure CMake
        run: |
          mkdir build
          cd build
          # Define a toolchain do Wii U e o caminho do WUT
          cmake .. -DCMAKE_TOOLCHAIN_FILE=/opt/devkitpro/wut/share/wut.toolchain.cmake -DPLATFORM=WIIU

      - name: Build project
        run: |
          cd build
          make

      - name: Upload Artifact
        uses: actions/upload-artifact@v4
        with:
          name: SonicOrigins-WiiU
          path: build/*.rpx
